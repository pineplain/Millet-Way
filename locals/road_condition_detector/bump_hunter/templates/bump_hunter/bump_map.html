{% extends "base.html" %}

{% block title %}Bump Map{% endblock title %}

{% block content %}
<div class="container-fluid">
  <h3 class="page-header">Bump Map</h3>
  <div id="input-container">
    <table align="left">
      <tr>
        <td>
          <form id="geocoding_form" class="form-inline" method="post">
            <div class="form-group">
              <input type="text" class="form-control" id="address" placeholder="tokyo station">
            </div>
            <button type="submit" class="btn btn-primary">Geocoarding</button>
          </form>
        </td>
      </tr>
    </table>
  </div>
  <div id="bump-map"></div>
</div>

<script>
$(document).ready(function(){
    var map = new GMaps({
        div: '#bump-map',
        lat: 35.90061,
        lng: 139.933694
    });

    // geocoding
    GMaps.geocode({
        address: $('#address').val(),
        callback: function(results, status) {
            if (status == 'OK') {
                var latlng = results[0].geometry.location;
                map.setCenter(latlng.lat(), latlng.lng());
                map.addMarker({
                    lat: latlng.lat(),
                    lng: latlng.lng()
                });
            }
        }
    });
    $('#geocoding_form').submit(function(e){
        e.preventDefault();
        GMaps.geocode({
            address: $('#address').val().trim(),
            callback: function(results, status){
                if(status=='OK'){
                    var latlng = results[0].geometry.location;
                    map.setCenter(latlng.lat(), latlng.lng());
                    map.addMarker({
                        lat: latlng.lat(),
                        lng: latlng.lng()
                    });
                }
            }
        });
    });

    // visualization of log data
    $.ajax({
        url: 'get_all/',
        type: 'GET',
        dataType: 'json',
        success: function(response) {
            // console.log(response);
            for (var i = 0; i < response.all_log_data.length; i++) {
                var data = response.all_log_data[i];
                // console.log(data);
                map.addMarker({
                    lat: data.lat,
                    lng: data.lon,
                    title: data.logged_at,
                    click: function(e) {
                        // alert('clicked action');
                    },
                    infoWindow: {
                        content: '<p>acc: ' + data.acc.toFixed(3) + ' m/s^2</p>',
                    },
                });
            }
        },
    });
});
</script>
{% endblock content %}
